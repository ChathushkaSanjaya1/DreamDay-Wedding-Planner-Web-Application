@{
    ViewData["Title"] = "Manage Vendors";
}

@section Styles {
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Quicksand', sans-serif;
            background-color: #f5f7fa;
        }

        .sidebar {
            background: linear-gradient(180deg, #1E88E5 0%, #3949AB 100%);
            color: #fff;
            min-height: 100vh;
        }

            .sidebar .nav-link {
                color: #e0e0e0;
                font-weight: 500;
            }

                .sidebar .nav-link.active {
                    background-color: #fff;
                    color: #3949AB !important;
                    font-weight: bold;
                    border-radius: 8px;
                }

        .badge-approved {
            background-color: #66BB6A;
        }

        .badge-pending {
            background-color: #FFA726;
        }

        .badge-rejected {
            background-color: #EF5350;
        }

        .table th, .table td {
            vertical-align: middle;
        }
    </style>
}

<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <nav class="col-12 col-md-3 col-lg-2 sidebar p-4">
            <h4 class="fw-bold text-white mb-4"><i class="fas fa-user-shield me-2"></i>Admin</h4>
            <ul class="nav flex-column">
                <li class="nav-item"><a class="nav-link" asp-controller="Admin" asp-action="Index"><i class="fas fa-tachometer-alt me-2"></i>Dashboard</a></li>
                <li class="nav-item"><a class="nav-link" asp-controller="Admin" asp-action="Users"><i class="fas fa-users me-2"></i>Users</a></li>
                <li class="nav-item"><a class="nav-link active" asp-controller="Admin" asp-action="Vendors"><i class="fas fa-store me-2"></i>Vendors</a></li>
                <li class="nav-item"><a class="nav-link" asp-controller="Admin" asp-action="Weddings"><i class="fas fa-calendar-alt me-2"></i>Weddings</a></li>
                <li class="nav-item"><a class="nav-link" asp-controller="Admin" asp-action="Reports"><i class="fas fa-chart-bar me-2"></i>Reports</a></li>
            </ul>
        </nav>

        <!-- Main Content -->
        <main class="col-12 col-md-9 col-lg-10 px-4 py-5">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2 class="fw-bold text-primary"><i class="fas fa-store me-2"></i>Manage Vendors</h2>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#vendorModal" onclick="openAddVendorModal()">
                    <i class="fas fa-plus me-1"></i> Add Vendor
                </button>
            </div>

            <div class="card p-4 shadow-sm">
                <div class="table-responsive">
                    <table class="table table-bordered table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>#</th>
                                <th>Vendor Name</th>
                                <th>Category</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="vendorTableBody"></tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
</div>

<!-- Add/Edit Vendor Modal -->
<div class="modal fade" id="vendorModal" tabindex="-1" aria-labelledby="vendorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form onsubmit="saveVendor(event)">
                <div class="modal-header">
                    <h5 class="modal-title" id="vendorModalLabel">Add / Edit Vendor</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="vendorIndex" />
                    <div class="mb-3">
                        <label class="form-label">Vendor Name</label>
                        <input type="text" class="form-control" id="vendorName" required />
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Category</label>
                        <select class="form-select" id="vendorCategory" required>
                            <option value="Venue">Venue</option>
                            <option value="Catering">Catering</option>
                            <option value="Photography">Photography</option>
                            <option value="Florist">Florist</option>
                            <option value="Music/DJ">Music/DJ</option>
                            <option value="Makeup">Makeup</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Status</label>
                        <select class="form-select" id="vendorStatus" required>
                            <option value="Approved">Approved</option>
                            <option value="Pending">Pending</option>
                            <option value="Rejected">Rejected</option>
                        </select>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Vendor</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let vendorList = JSON.parse(localStorage.getItem("dreamdayVendorsAdmin")) || [
            { name: "Golden Garden", category: "Venue", status: "Approved" },
            { name: "Lens & Love", category: "Photography", status: "Pending" },
            { name: "Flavors Catering", category: "Catering", status: "Approved" }
        ];

        function saveToStorage() {
            localStorage.setItem("dreamdayVendorsAdmin", JSON.stringify(vendorList));
        }

        function renderVendors() {
            const tbody = document.getElementById("vendorTableBody");
            tbody.innerHTML = "";

            vendorList.forEach((vendor, index) => {
                const badgeClass = vendor.status === "Approved" ? "badge-approved"
                                  : vendor.status === "Pending" ? "badge-pending"
                                  : "badge-rejected";

                tbody.innerHTML += `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${vendor.name}</td>
                        <td>${vendor.category}</td>
                        <td><span class="badge ${badgeClass} text-white">${vendor.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-warning me-2" onclick="openEditVendor(${index})"><i class="fas fa-edit"></i></button>
                            <button class="btn btn-sm btn-danger" onclick="deleteVendor(${index})"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
            });

            saveToStorage();
        }

        function openAddVendorModal() {
            document.getElementById("vendorModalLabel").textContent = "Add New Vendor";
            document.getElementById("vendorForm")?.reset();
            document.getElementById("vendorIndex").value = "";
            document.getElementById("vendorName").value = "";
            document.getElementById("vendorCategory").value = "Venue";
            document.getElementById("vendorStatus").value = "Approved";
        }

        function openEditVendor(index) {
            const vendor = vendorList[index];
            document.getElementById("vendorModalLabel").textContent = "Edit Vendor";
            document.getElementById("vendorIndex").value = index;
            document.getElementById("vendorName").value = vendor.name;
            document.getElementById("vendorCategory").value = vendor.category;
            document.getElementById("vendorStatus").value = vendor.status;
            new bootstrap.Modal(document.getElementById("vendorModal")).show();
        }

        function saveVendor(event) {
            event.preventDefault();

            const index = document.getElementById("vendorIndex").value;
            const name = document.getElementById("vendorName").value;
            const category = document.getElementById("vendorCategory").value;
            const status = document.getElementById("vendorStatus").value;

            const newVendor = { name, category, status };

            if (index === "") {
                vendorList.push(newVendor);
            } else {
                vendorList[parseInt(index)] = newVendor;
            }

            bootstrap.Modal.getInstance(document.getElementById("vendorModal")).hide();
            renderVendors();
        }

        function deleteVendor(index) {
            if (confirm("Are you sure you want to delete this vendor?")) {
                vendorList.splice(index, 1);
                renderVendors();
            }
        }

        renderVendors();
    </script>
}
